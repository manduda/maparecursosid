<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fnc="http://yournamespace.com/fnc">
    <ui:composition>
        <h:panelGroup id="displayMatriz" rendered="#{facesContext.externalContext.requestServletPath != fnc:concat(ConfiguracionBean.rutaContexto,'numeracion-matriz.xhtml')}">

            <h:panelGrid id="datosMatriz" style="width:100%" >
                <h:panelGrid id="pgDatosMatriz" columns="2" >
                    <h:outputText value="Inicio: "/>
                    <h:outputText value="#{NumeracionBean.numInicio}"/>
                    <h:outputText value="Fin: "/>
                    <h:outputText value="#{NumeracionBean.numFin}"/>
                </h:panelGrid>
                
                <h:panelGroup>
                    <table border="1" style="font-size:8px;width:100%;border-collapse: collapse;" class="estilo" cellpadding="0" cellspacing="0">
                        <thead>
                            <tr style="text-align: center; height:25px" class="columna-matriz">
                                <th>Rango</th>
                                <th>0</th>
                                <th>1</th>
                                <th>2</th>
                                <th>3</th>
                                <th>4</th>
                                <th>5</th>
                                <th>6</th>
                                <th>7</th>
                                <th>8</th>
                                <th>9</th>
                            </tr>
                        </thead>
                        <ui:repeat value="#{NumeracionBean.numer}" var="datos">
                            <tr style="height:27px;">
                                <td style="text-align: center;" class="columna-matriz">
                                    <h:outputText value="#{datos[0]}"/>  
                                </td>
                                <ui:repeat value="#{datos}" var="nu" offset="1">
                                    <td id="hola" style="text-align:center; width:9.5%;
                                        #{fnc:countLista(nu) == 1 and nu[0].esnCodigo.esnCodigo == '3' ? 
                                          fnc:concat(fnc:concat('background-color:',fnc:toColorCode(nu[0].emrCodigo.emrCodigo)),
                                          fnc:concat(';color:',fnc:toColorCodeFont(nu[0].emrCodigo.emrCodigo))) : ''}"
                                        class="#{fnc:countLista(nu) == 1 and nu[0].esnCodigo.esnCodigo == '4' ? 'estado-reserva' : ''}">
                                        <h:panelGroup rendered="#{fnc:countLista(nu) == 1}">
                                            <h:panelGrid id="columna" width="100%">
                                                <p:ajax event="click" update=":pgDatosMatriz" >
                                                    <f:setPropertyActionListener target="#{NumeracionBean.numInicio}" value="#{nu[0].nunInicio}" />
                                                </p:ajax>
                                                <h:outputText  value="#{nu[0].codigoMunicipio.nombreMunicipio}"/>
                                            </h:panelGrid>
                                            
                                            <p:tooltip for="columna" styleClass="tooltip">
                                                <h:outputText value="Operador: " style="font-weight: bold"/>
                                                <h:outputText value="#{nu[0].emrCodigo.emtNombre}"/><br/>
                                                <h:outputText value="Municipio: " style="font-weight: bold"/>
                                                <h:outputText value="#{nu[0].codigoMunicipio.nombreMunicipio} (#{nu[0].codigoMunicipio.codigoDepartamento.nombreDepartamento})"/><br/>
                                                <h:outputText value="Estado: " style="font-weight: bold"/>
                                                <h:outputText value="#{nu[0].esnCodigo.estNombre}"/>
                                            </p:tooltip>
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{fnc:countLista(nu) > 1}">
                                            <table style="width:100%;height:27px;border-collapse: collapse;border-style: hidden;" cellpadding="0" cellspacing="0" >
                                                <tr>
                                                    <ui:repeat value="#{nu}" var="num">
                                                        <h:panelGroup rendered="#{num.codigoMunicipio.nombreMunicipio != null}">
                                                            <td style="border: 1px solid black;width:#{(num.nunFin - num.nunInicio + 1)/10}%;
                                                                #{num.esnCodigo.esnCodigo == '3' ? 
                                                                  fnc:concat(fnc:concat('background-color:',fnc:toColorCode(num.emrCodigo.emrCodigo)),
                                                                  fnc:concat(';color:',fnc:toColorCodeFont(num.emrCodigo.emrCodigo))) : ''}"
                                                                class="#{num.esnCodigo.esnCodigo == '4' ? 'estado-reserva' : ''}">
                                                                <h:panelGrid id="celda" width="100%" cellpadding="0" cellspacing="0">
                                                                    <p:ajax event="click" update=":pgDatosMatriz" >
                                                                        <f:setPropertyActionListener target="#{NumeracionBean.numInicio}" value="#{num.nunInicio}" />
                                                                    </p:ajax>
                                                                    <h:panelGroup rendered="#{num.nunFin - num.nunInicio + 1 > 100}">
                                                                        <h:outputText value="#{num.nunFin - num.nunInicio + 1}" converter="javax.faces.Integer"/>
                                                                    </h:panelGroup>
                                                                    <h:panelGroup rendered="#{num.nunFin - num.nunInicio + 1 == 100 and num.esnCodigo.esnCodigo == '3'}">
                                                                        <p:graphicImage style="border:0px" value="#{ConfiguracionBean.rutaContexto}resources/images/100-#{fnc:toColorCodeFont(num.emrCodigo.emrCodigo) == '#000000' ? 'N' : 'B'}.png" />
                                                                    </h:panelGroup>
                                                                    <h:panelGroup rendered="#{num.nunFin - num.nunInicio + 1 == 100 and num.esnCodigo.esnCodigo != '3'}">
                                                                        <p:graphicImage style="border:0px" value="#{ConfiguracionBean.rutaContexto}resources/images/100-#{num.esnCodigo.esnCodigo == '4' ? 'B' : 'N'}.png" />
                                                                    </h:panelGroup>
                                                                </h:panelGrid>
                                                                <p:tooltip for="celda" styleClass="tooltip">
                                                                    <h:outputText value="Operador: " style="font-weight: bold"/>
                                                                    <h:outputText value="#{num.emrCodigo.emtNombre}"/><br/>
                                                                    <h:outputText value="Municipio: " style="font-weight: bold"/>
                                                                    <h:outputText value="#{num.codigoMunicipio.nombreMunicipio} (#{num.codigoMunicipio.codigoDepartamento.nombreDepartamento})"/><br/>
                                                                    <h:outputText value="Estado: " style="font-weight: bold"/>
                                                                    <h:outputText value="#{num.esnCodigo.estNombre}"/>
                                                                </p:tooltip>
                                                            </td>
                                                        </h:panelGroup>
                                                    </ui:repeat>
                                                </tr>
                                            </table>
                                        </h:panelGroup>
                                    </td>
                                </ui:repeat>
                            </tr>
                        </ui:repeat>
                    </table>
                </h:panelGroup>
                
                <p:dialog widgetVar="dialog" >
                    <h:outputText value="prueba"/>
                </p:dialog>
                
            </h:panelGrid>
        </h:panelGroup>
    </ui:composition>
</html>