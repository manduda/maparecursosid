<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:fnc="http://yournamespace.com/fnc">
    <ui:composition>
        <h:panelGroup id="displayMatriz" rendered="#{facesContext.externalContext.requestServletPath != fnc:concat(ConfiguracionBean.rutaContexto,'numeracion-matriz.xhtml')}">
            <script language="javascript">
                <!--
                seleccionId = "";
                seleccionIdAnterior = "-1";
                seleccionRango = false;
                function seleccionar(id){
                    seleccionId = id;
                    
                    longitug = seleccionId.length();
                    x = parseInt(seleccionId.substring(0, longitug-2));
                    y = parseInt(seleccionId.substring(longitug-2, longitug-1));
                    z = parseInt(seleccionId.substring(longitug-1, longitug));

                    if ((!seleccionRango) && (seleccionIdAnterior.equals("-1"))){
                        colorCelda(x,y,z,true);
                        //RequestContext.getCurrentInstance().update("columna"+seleccionId);
                        seleccionIdAnterior = seleccionId;
                    } else if ((!seleccionRango) && (!seleccionIdAnterior.equals("-1"))) {
                        longitugA = seleccionIdAnterior.length();
                        xA = parseInt(seleccionIdAnterior.substring(0, longitugA-2));
                        yA = parseInt(seleccionIdAnterior.substring(longitugA-2, longitugA-1));
                        zA = parseInt(seleccionIdAnterior.substring(longitugA-1, longitugA));
                        colorCeldas(xA,yA,zA,x,y,z,true);
                        seleccionRango = true;
                    } else {
                        limpiarColorCeldas();
                        colorCelda(x,y,z,true);
                        seleccionRango = false;
                        seleccionIdAnterior = seleccionId;
                    }
                    
                    /*backgroud = 'rgb(0, 0, 0)';
                    color = 'rgb(255, 255, 255)';
                    border = 'rgb(255, 255, 255)';
                    //alert(document.getElementById('h'+id).style.border);
                    if (document.getElementById(id).style.background == backgroud){
                        backgroud = document.getElementById('h'+id).style.background;
                        color = document.getElementById('h'+id).style.color;
                        border = document.getElementById('h'+id).style.border;
                    }
                    document.getElementById(id).style.background = backgroud;
                    document.getElementById(id).style.color = color;
                    document.getElementById(id).style.border = border;*/
                    //alert(document.getElementById(id).style.background);
                }
    
                function colorCelda(id, seleccionar){
                    estilo = "background:#828282;color:#000000";
                    
                    backgroud = 'rgb(0, 0, 0)';
                    color = 'rgb(255, 255, 255)';
                    border = 'rgb(255, 255, 255)';
                    //alert(document.getElementById('h'+id).style.border);
                    if (!seleccionar){
                        backgroud = document.getElementById('h'+id).style.background;
                        color = document.getElementById('h'+id).style.color;
                        border = document.getElementById('h'+id).style.border;
                    }
                    document.getElementById(id).style.background = backgroud;
                    document.getElementById(id).style.color = color;
                    document.getElementById(id).style.border = border;
                }
    
            /*function colorCeldas(x1, y1, z1,x2, y2, z2, seleccionar){
                //colorCelda(x2,y2,z2,true);

                for(i = x1; i <= x2; i++){
                    List array = (ArrayList)numer.get(i);
                    sizeX1 = 1;
                    sizeX2 = array.size()-1;
                    if (i == x1){
                        sizeX1 = y1+1;
                    }
                    if (i == x2){
                        sizeX2 = y2+1;
                    }
                    for(int j = sizeX1; j <= sizeX2; j++){
                        List array2 = (ArrayList)array.get(j);
                        int sizeY1 = 0;
                        int sizeY2 = array2.size();
                        if ((i == x1)&&(j-1 == y1)){
                            sizeY1 = z1;
                        }
                        if ((i == x2)&&(j-1 == y2)){
                            sizeY2 = z2+1;
                        }
                        for(int k = sizeY1; k < sizeY2; k++){
                            colorCelda(i,j-1,k,seleccionar);
                        }

                    }
                }
            }*/
                -->
            </script>
            <h:panelGrid id="datosMatriz" style="width:100%" >
                
                <h:panelGrid id="pgDatosMatriz" columns="3" >
                    <h:outputText value=""/>
                    <h:outputText value="NDC"/>
                    <h:outputText value="NÃºmero"/>
                    <h:outputText value="Inicio: "/>
                    <h:outputText value="#{NumeracionBean.seleccionNumAnterior.ndnCodigo.ndtNombre}"/>
                    <h:outputText value="#{NumeracionBean.seleccionNumAnterior.nunInicio}"/>
                    <h:outputText value="Fin: "/>
                    <h:outputText value="#{NumeracionBean.seleccionNum.ndnCodigo.ndtNombre}"/>
                    <h:outputText value="#{NumeracionBean.seleccionNum.nunFin}"/>
                </h:panelGrid>
                
                <h:panelGroup id="pgDatos">
                    <table border="1" style="font-size:8px;width:100%;border-collapse: collapse;" class="estilo" cellpadding="0" cellspacing="0">
                        <thead>
                            <tr style="text-align: center; height:25px" class="ui-widget-header">
                                <th>Rango</th>
                                <th>0</th>
                                <th>1</th>
                                <th>2</th>
                                <th>3</th>
                                <th>4</th>
                                <th>5</th>
                                <th>6</th>
                                <th>7</th>
                                <th>8</th>
                                <th>9</th>
                            </tr>
                        </thead>
                        <ui:repeat value="#{NumeracionBean.numer}" var="datos">
                            <tr style="height:27px;">
                                <td style="text-align: center;" class="ui-widget-header">
                                    <h:outputText value="#{datos[0]}"/>  
                                </td>
                                <ui:repeat value="#{datos}" var="nu" offset="1">
                                    <td id="columna#{nu[0][2]}" style="border: 1px solid black;text-align:center; width:9.5%;#{fnc:countLista(nu) == 1 ? nu[0][1] : ''}">
                                        <input id="hcolumna#{nu[0][2]}" type="hidden" style="#{fnc:countLista(nu) == 1 ? nu[0][1] : ''}"/>
                                        <h:panelGroup id="colum" rendered="#{fnc:countLista(nu) == 1}">
                                            <h:panelGrid id="celda" width="100%" cellpadding="0" cellspacing="0" style="height:27px">
                                                <p:commandLink action="#{NumeracionBean.seleccionarNumeracion}" update=":pgDatos,:pgDatosMatriz" styleClass="celda" >
                                                    <h:outputText  value="#{nu[0][0].codigoMunicipio.nombreMunicipio}" />
                                                    <f:setPropertyActionListener target="#{NumeracionBean.seleccionNum}" value="#{nu[0][0]}" />
                                                    <f:setPropertyActionListener target="#{NumeracionBean.seleccionId}" value="#{nu[0][2]}" />
                                                </p:commandLink>
                                                
                                                
                                            </h:panelGrid>
                                            
                                            <p:tooltip for="celda" styleClass="tooltip">
                                                <h:outputText value="Operador: " style="font-weight: bold"/>
                                                <h:outputText value="#{nu[0][0].emrCodigo.emtNombre}"/><br/>
                                                <h:outputText value="Municipio: " style="font-weight: bold"/>
                                                <h:outputText value="#{nu[0][0].codigoMunicipio.nombreMunicipio} (#{nu[0][0].codigoMunicipio.codigoDepartamento.nombreDepartamento})"/><br/>
                                                <h:outputText value="Estado: " style="font-weight: bold"/>
                                                <h:outputText value="#{nu[0][0].esnCodigo.estNombre}"/>
                                            </p:tooltip>
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{fnc:countLista(nu) > 1}">
                                            <table style="width:100%;height:27px;border-collapse: collapse;border-style: hidden;" cellpadding="0" cellspacing="0" >
                                                <tr>
                                                    <ui:repeat value="#{nu}" var="num">
                                                        <h:panelGroup rendered="#{num[0].codigoMunicipio.nombreMunicipio != null}">
                                                            <td style="border: 1px solid black;width:#{(num[0].nunFin - num[0].nunInicio + 1)/10}%;#{num[1]}">
                                                                <h:panelGrid id="subcelda" width="100%" cellpadding="0" cellspacing="0">
                                                                    <p:commandLink action="#{NumeracionBean.seleccionarNumeracion}" update=":pgDatos,:pgDatosMatriz" styleClass="celda">
                                                                        <f:setPropertyActionListener target="#{NumeracionBean.seleccionNum}" value="#{num[0]}" />
                                                                        <f:setPropertyActionListener target="#{NumeracionBean.seleccionId}" value="#{num[2]}" />
                                                                        <h:panelGroup rendered="#{num[0].nunFin - num[0].nunInicio + 1 > 100}">
                                                                            <h:outputText value="#{num[0].nunFin - num[0].nunInicio + 1}" converter="javax.faces.Integer"/>
                                                                        </h:panelGroup>
                                                                        <h:panelGroup rendered="#{num[0].nunFin - num[0].nunInicio + 1 == 100 and num[0].esnCodigo.esnCodigo == '3'}">
                                                                            <p:graphicImage style="border:0px" value="#{ConfiguracionBean.rutaContexto}resources/images/100-#{fnc:toColorCodeFont(num[0].emrCodigo.emrCodigo) == '#000000' ? 'N' : 'B'}.png" />
                                                                        </h:panelGroup>
                                                                        <h:panelGroup rendered="#{num[0].nunFin - num[0].nunInicio + 1 == 100 and num[0].esnCodigo.esnCodigo != '3'}">
                                                                            <p:graphicImage style="border:0px" value="#{ConfiguracionBean.rutaContexto}resources/images/100-#{num[0].esnCodigo.esnCodigo == '4' ? 'B' : 'N'}.png" />
                                                                        </h:panelGroup>
                                                                    </p:commandLink>
                                                                </h:panelGrid>
                                                                <p:tooltip for="subcelda" styleClass="tooltip">
                                                                    <h:outputText value="Operador: " style="font-weight: bold"/>
                                                                    <h:outputText value="#{num[0].emrCodigo.emtNombre}"/><br/>
                                                                    <h:outputText value="Municipio: " style="font-weight: bold"/>
                                                                    <h:outputText value="#{num[0].codigoMunicipio.nombreMunicipio} (#{num[0].codigoMunicipio.codigoDepartamento.nombreDepartamento})"/><br/>
                                                                    <h:outputText value="Estado: " style="font-weight: bold"/>
                                                                    <h:outputText value="#{num[0].esnCodigo.estNombre}"/>
                                                                </p:tooltip>
                                                            </td>
                                                        </h:panelGroup>
                                                    </ui:repeat>
                                                </tr>
                                            </table>
                                        </h:panelGroup>
                                    </td>
                                </ui:repeat>
                            </tr>
                        </ui:repeat>
                    </table>
                </h:panelGroup>
                
                <p:dialog widgetVar="dialog" >
                    <p:panelGrid id="pgDialog">
                        <h:outputText value="#{NumeracionBean.numInicio}"/>
                    </p:panelGrid>
                    
                </p:dialog>
                
            </h:panelGrid>
        </h:panelGroup>
    </ui:composition>
</html>