<ui:composition template="#{ConfiguracionBean.rutaContexto}resources/Plantillas/normal.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui">

    <ui:define name="titulo">
        <h:outputText value="Administrar modulos"/>
    </ui:define>

    <ui:define name="content">
        <h:panelGroup rendered="#{!UserBean.administrarModulos}">
            <h:panelGrid width="100%">
                <br/><br/><br/>
                <h:panelGrid style="text-align: center; margin: 0px auto; color: red; font-weight: bold" >
                        <h:outputText value="No tienes permiso para acceder a esta sección"/>
                </h:panelGrid>
            </h:panelGrid>
        </h:panelGroup>
        
        <h:panelGroup rendered="#{UserBean.administrarModulos}">
            <br/>
            <h:panelGroup id="pgModulos">
                <h:form id="listaModulos">
                    <p:dataTable id="datos" value="#{AdministracionAplicacionBean.modulos}" var="m" rowKey="#{m.cmnCodigo}"
                                 selectionMode="single" selection="#{AdministracionAplicacionBean.selectedModulo}"
                                 style="font-size:10px;width:400px;" rows="10" emptyMessage="No se encontraron modulos" 
                                 rowStyleClass="#{m.cmtActivo == 'S' ? 'permiso-asignado' : 'permiso-no-asignado'}">
                        <p:ajax event="rowSelect" update=":datosAdministrar" oncomplete="administrarDialog.show();"/>
                        <p:ajax event="rowUnselect" update=":datosAdministrar" />
                        
                        <f:facet name="header">Lista de módulos de la aplicación</f:facet>
                        <p:column headerText="NOMBRE DEL MÓDULO" style="text-align: left;">
                            <h:outputText value="#{m.cmtModulo}"/>
                        </p:column>
                        <p:column headerText="ACTIVO" style="width:80px; text-align: center;">
                            <p:graphicImage rendered="#{m.cmtActivo == 'S'}" value="#{ConfiguracionBean.rutaContexto}resources/images/visto_bueno.png" style="border:0px" height="15"/>
                            <p:graphicImage rendered="#{m.cmtActivo == 'N'}" value="#{ConfiguracionBean.rutaContexto}resources/images/error.png" style="border:0px" height="15"/>

                        </p:column>
                    </p:dataTable>
                </h:form>
            </h:panelGroup>
            
            <p:dialog header="Administrar módulo" widgetVar="administrarDialog" resizable="false" modal="true" draggable="false"
                      width="200" showEffect="fade" hideEffect="fade" position="center">
                <h:panelGrid id="datosAdministrar" width="100%" style="font-size: 12px;" >
                    
                        <h:panelGrid width="100%"  cellpadding="0" cellspacing="0">
                            <h:panelGrid columns="2" cellpadding="0" cellspacing="0">
                                <h:outputText value="Módulo:&#160;" style="font-weight: bold;"/>
                                <h:outputText value="#{AdministracionAplicacionBean.selectedModulo.cmtModulo}"/>
                            </h:panelGrid>
                            <br/>
                            
                            <h:form id="frmDatos">
                                <h:panelGrid columns="2" width="100%" style="text-align: center;">
                                    <p:commandButton value="Activar" action="#{AdministracionAplicacionBean.activarDesactivar}" rendered="#{AdministracionAplicacionBean.selectedModulo.cmtActivo == 'N'}" update=":datosResultado,:listaModulos,:menubar" oncomplete="administrarDialog.hide();resultadoDialog.show();">
                                        <f:setPropertyActionListener target="#{AdministracionAplicacionBean.activar}" value="S"/>
                                    </p:commandButton>
                                    <p:commandButton value="Desactivar" action="#{AdministracionAplicacionBean.activarDesactivar}" rendered="#{AdministracionAplicacionBean.selectedModulo.cmtActivo == 'S'}" update=":datosResultado,:listaModulos,:menubar" oncomplete="administrarDialog.hide();resultadoDialog.show();">
                                        <f:setPropertyActionListener target="#{AdministracionAplicacionBean.activar}" value="N"/>
                                    </p:commandButton>
                                    <p:commandButton type="button" value="Cancelar" onclick="administrarDialog.hide();"/>
                                </h:panelGrid>
                            </h:form>
                        </h:panelGrid>
                    
                 </h:panelGrid>
            </p:dialog>

            <p:dialog header="Resultado" widgetVar="resultadoDialog" resizable="false" modal="true" draggable="false"
                      width="400" showEffect="fade" hideEffect="fade" position="center" closable="false">
                <h:panelGrid id="datosResultado" style="text-align: center; " width="100%">
                    <h:outputText value="#{AdministracionAplicacionBean.mensajeAdminModulo}" escape="false"/>
                    <p:commandButton type="button" value="Aceptar" onclick="resultadoDialog.hide();" />
                </h:panelGrid>
            </p:dialog>
            
            
            
            
        </h:panelGroup>
    </ui:define>
</ui:composition>

