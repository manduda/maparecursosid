<ui:composition template="#{ConfiguracionBean.rutaContexto}resources/Plantillas/normal.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.prime.com.tr/ui">

    <ui:define name="titulo">
        <h:outputText value="Administrar usuarios"/>
    </ui:define>

    <ui:define name="content">
        <h:panelGroup rendered="#{!UserBean.administrarUsuarios}">
            <h:panelGrid width="100%">
                <br/><br/><br/>
                <h:panelGrid style="text-align: center; margin: 0px auto; color: red; font-weight: bold" >
                        <h:outputText value="No tienes permiso para acceder a esta sección"/>
                </h:panelGrid>
            </h:panelGrid>
        </h:panelGroup>
        
        <h:panelGroup rendered="#{UserBean.administrarUsuarios}">
            <h:form>
                <h:panelGrid id="pgUsuarios" columns="2">
                    <h:outputText value="Escoger usuario"/>
                    <h:selectOneMenu value="#{TramiteBean.usuariosBuscar}">
                        <f:selectItems value="#{TramiteBean.listaUsuariosSIUST}"/>
                        <p:ajax update="pgAdminUsuarios" listener="#{TramiteBean.buscarUsuario}" />
                    </h:selectOneMenu>
                </h:panelGrid>
            </h:form>
            <p:separator/>

            <h:panelGrid id="pgAdminUsuarios" width="100%">
                <h:panelGrid rendered="#{TramiteBean.usuariosEncontrado.codigoSIUST.userCode != null}">
                    <h:panelGrid columns="2">
                        <h:outputText value="Usuario" style="font-weight: bold;"/>
                        <h:outputText value="#{TramiteBean.usuariosEncontrado.codigoSIUST.login}"/>
                        <h:outputText value="Código usuario" style="font-weight: bold;"/>
                        <h:outputText value="#{TramiteBean.usuariosEncontrado.codigoSIUST.userCode}"/>
                        <h:outputText value="Nombre" style="font-weight: bold;"/>
                        <h:outputText value="#{TramiteBean.usuariosEncontrado.codigoSIUST.name} #{TramiteBean.usuariosEncontrado.codigoSIUST.lastName}"/>
                        <h:outputText value="Email" style="font-weight: bold;"/>
                        <h:outputLink value="mailto:#{TramiteBean.usuariosEncontrado.codigoSIUST.email}">
                            <h:outputText value="#{TramiteBean.usuariosEncontrado.codigoSIUST.email}" />
                        </h:outputLink>
                        <h:outputText value="Tipo de usuario" style="font-weight: bold;"/>
                        <h:outputText value="#{TramiteBean.usuariosEncontrado.tunCodigo.tutNombre == null ? 'SIN PERMISOS' : TramiteBean.usuariosEncontrado.tunCodigo.tutNombre}" style="font-weight: bold; #{TramiteBean.usuariosEncontrado.tunCodigo.tutNombre == null ? 'color: red;' : 'color: green;'}"/>
                    </h:panelGrid>

                    <h:panelGrid rendered="#{TramiteBean.usuariosEncontrado.tunCodigo.tunCodigo != 1}">
                        <h:form>
                            <p:commandButton type="button" value="Cambiar permisos" onclick="permisosDialog.show();"/>
                        </h:form>

                        <p:dialog header="Cambiar permisos" widgetVar="permisosDialog" resizable="false" modal="true" draggable="false"
                                  width="200" showEffect="fade" hideEffect="fade" position="center">
                            <h:panelGrid id="datosPermisos" width="100%" style="font-size: 10px;" >
                                <h:form>
                                    <h:panelGrid width="100%"  cellpadding="0" cellspacing="0">
                                        <h:panelGrid columns="2" cellpadding="0" cellspacing="0">
                                            <h:outputText value="Usuario:&#160;" style="font-weight: bold;"/>
                                            <h:outputText value="#{TramiteBean.usuariosEncontrado.codigoSIUST.login}"/>
                                        </h:panelGrid>
                                        <br/>
                                        <h:outputText value="Escoger perfil"/>
                                        <h:selectOneMenu value="#{TramiteBean.usuariosEncontrado.tunCodigo.tunCodigo}">
                                            <f:selectItem itemValue="0" itemLabel="SIN PERMISOS" />
                                            <f:selectItem itemValue="2" itemLabel="COORDINADOR"/>
                                            <f:selectItem itemValue="3" itemLabel="ASESOR"/>
                                        </h:selectOneMenu>
                                        <br/>
                                    </h:panelGrid>
                                    <h:panelGrid columns="2" width="100%" style="text-align: center;">
                                        <p:commandButton value="Aceptar" action="#{TramiteBean.cambiarPerfil}" update="datosResultado" oncomplete="permisosDialog.hide();resultadoDialog.show();"/>
                                        <p:commandButton type="button" value="Cancelar" onclick="permisosDialog.hide();"/>
                                    </h:panelGrid>
                                </h:form>
                             </h:panelGrid>
                        </p:dialog>

                        <p:dialog header="Resultado" widgetVar="resultadoDialog" resizable="false" modal="true" draggable="false"
                                  width="400" showEffect="fade" hideEffect="fade" position="center" closable="false">
                            <h:panelGrid id="datosResultado" style="text-align: center; " width="100%">
                                <h:form>
                                    <h:outputText value="#{TramiteBean.mensajeAdminUsuario}" escape="false"/>
                                    <p:commandButton value="Aceptar" onclick="resultadoDialog.hide();" update="pgAdminUsuarios,listaUsuarios"/>
                                 </h:form>
                            </h:panelGrid>
                        </p:dialog>

                    </h:panelGrid>

                </h:panelGrid>

            </h:panelGrid>

            <h:form id="listaUsuarios">
                <h:panelGroup id="pgUsuarios">
                    <p:dataTable id="datos" value="#{TramiteBean.usuariosAplicacion}" var="us"
                                 style="font-size:10px" rows="10" emptyMessage="No se encontraron usuarios" >
                        <f:facet name="header">Lista de usuarios de la aplicación</f:facet>
                        <p:column headerText="CÓDIGO USUARIO" sortBy="#{us.codigoSIUST.userCode}" style="width:80px; text-align: center;">
                            <h:outputText value="#{us.codigoSIUST.userCode}"/>
                        </p:column>
                        <p:column headerText="LOGIN" sortBy="#{us.codigoSIUST.login}" style="width:80px; text-align: center;">
                            <h:outputText value="#{us.codigoSIUST.login}"/>
                        </p:column>
                        <p:column headerText="NOMBRE" sortBy="#{us.codigoSIUST.name} #{us.codigoSIUST.lastName}" style="width:80px">
                            <h:outputText value="#{us.codigoSIUST.name} #{us.codigoSIUST.lastName}"/>
                        </p:column>
                        <p:column headerText="TIPO DE USUARIO" sortBy="#{us.tunCodigo.tutNombre}" style="width:80px">
                            <h:outputText value="#{us.tunCodigo.tutNombre}"/>
                        </p:column>
                    </p:dataTable>
                </h:panelGroup>
            </h:form>
            
        </h:panelGroup>
    </ui:define>
</ui:composition>

