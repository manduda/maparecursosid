<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition template="#{ConfiguracionBean.rutaContexto}resources/Plantillas/normal.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:fnc="http://yournamespace.com/fnc">

    <ui:define name="titulo">
        <h:outputText value="Numeración"/>
    </ui:define>

    <ui:define name="content">
        <h:panelGroup rendered="#{!ConfiguracionModulosBean.moduloNumeracion}">
            <h:outputText value="Este módulo está desactivado" style="color: red;"/>
        </h:panelGroup>
        <h:panelGroup rendered="#{ConfiguracionModulosBean.moduloNumeracion}">
            
            <p:panel header="Búsqueda" toggleable="true" toggleSpeed="100">
                <h:form id="frmNum">
                    <h:panelGrid id="pgNum">
                        <h:panelGrid columns="2">
                            
                            <h:outputText value="Operador" rendered="#{!NumeracionBean.matrizVisible}"/>
                            <h:panelGrid id="listaOperador" columns="2" cellspacing="0" cellpadding="0">
                                <h:selectOneMenu value="#{NumeracionBean.operadorVO.emrCodigo}" rendered="#{!NumeracionBean.matrizVisible}">
                                    <f:selectItems value="#{NumeracionBean.listaOperador}" />
                                    <p:ajax update="listaOperador" global="false"/>
                                </h:selectOneMenu>
                                <p:commandLink ajax="true" rendered="#{NumeracionBean.operadorVO.emrCodigo != -1}" update="listaOperador" global="false">
                                    <p:graphicImage value="#{ConfiguracionBean.rutaContexto}resources/images/borrar.png" style="border:0px"/>
                                    <f:setPropertyActionListener target="#{NumeracionBean.operadorVO.emrCodigo}" value="-1"/>
                                </p:commandLink>
                            </h:panelGrid>
                            
                            <h:outputText value="Departamento" rendered="#{!NumeracionBean.matrizVisible}"/>
                            <h:panelGrid id="listaDepartamento" columns="2" cellspacing="0" cellpadding="0">
                                <h:selectOneMenu value="#{NumeracionBean.departamentoVO.codigoDepartamento}" rendered="#{!NumeracionBean.matrizVisible}">
                                    <f:selectItems value="#{NumeracionBean.listaDepartamento}" />
                                    <p:ajax update="listaDepartamento,listaMunicipio,listaNdc" listener="#{NumeracionBean.cambiarDepartamento}"/>
                                </h:selectOneMenu>
                                <p:commandLink ajax="true" rendered="#{NumeracionBean.departamentoVO.codigoDepartamento != -1}" update="listaDepartamento,listaMunicipio,listaNdc" action="#{NumeracionBean.cambiarDepartamento}">
                                    <p:graphicImage value="#{ConfiguracionBean.rutaContexto}resources/images/borrar.png" style="border:0px"/>
                                    <f:setPropertyActionListener target="#{NumeracionBean.departamentoVO.codigoDepartamento}" value="-1" />
                                    <f:setPropertyActionListener target="#{NumeracionBean.municipioVO.codigoMunicipio}" value="-1" />
                                </p:commandLink>
                            </h:panelGrid>
                            
                            <h:outputText value="Municipio" rendered="#{!NumeracionBean.matrizVisible}"/>
                            <h:panelGrid id="listaMunicipio" columns="2" cellspacing="0" cellpadding="0">
                                <h:selectOneMenu id="municipios" value="#{NumeracionBean.municipioVO.codigoMunicipio}" rendered="#{!NumeracionBean.matrizVisible}">
                                    <f:selectItems value="#{NumeracionBean.listaMunicipio}" />
                                    <p:ajax update="listaMunicipio" global="false"/>
                                </h:selectOneMenu>
                                <p:commandLink ajax="true" rendered="#{NumeracionBean.municipioVO.codigoMunicipio != -1}" update="listaMunicipio" global="false">
                                    <p:graphicImage value="#{ConfiguracionBean.rutaContexto}resources/images/borrar.png" style="border:0px"/>
                                    <f:setPropertyActionListener target="#{NumeracionBean.municipioVO.codigoMunicipio}" value="-1"/>
                                </p:commandLink>
                            </h:panelGrid>
                            
                            <h:outputText value="Estado" rendered="#{!NumeracionBean.matrizVisible}"/>
                            <h:panelGrid id="listaEstado" columns="2" cellspacing="0" cellpadding="0">
                                <h:selectOneMenu value="#{NumeracionBean.estadoVO.esnCodigo}" rendered="#{!NumeracionBean.matrizVisible}">
                                    <f:selectItems value="#{NumeracionBean.listaEstado}" />
                                    <p:ajax update="listaEstado" global="false"/>
                                </h:selectOneMenu>
                                <p:commandLink ajax="true" rendered="#{NumeracionBean.estadoVO.esnCodigo != -1}" update="listaEstado" global="false">
                                    <p:graphicImage value="#{ConfiguracionBean.rutaContexto}resources/images/borrar.png" style="border:0px"/>
                                    <f:setPropertyActionListener target="#{NumeracionBean.estadoVO.esnCodigo}" value="-1"/>
                                </p:commandLink>
                            </h:panelGrid>
                            
                            <h:outputText value="NDC" />
                            <h:panelGrid id="listaNdc" columns="3" cellpadding="0" cellspacing="0">
                                <h:selectOneMenu value="#{NumeracionBean.ndcVO.ndtNombre}">
                                    <f:selectItems value="#{NumeracionBean.listaNDC}" /> 
                                    <p:ajax update="tipoNumeracion" listener="#{NumeracionBean.cambiarNdc}" disabled="#{NumeracionBean.matrizVisible}"/>
                                </h:selectOneMenu>
                                <h:outputText value="&#160;&#160;&#160;&#160;&#160;" />
                                <h:panelGroup id="tipoNumeracion" rendered="#{!NumeracionBean.matrizVisible}">
                                    <h:panelGrid rendered="#{NumeracionBean.ndcVO.ndtNombre == '-1' ? false : true}" columns="4" cellpadding="0" cellspacing="0" >
                                        <h:outputText value="Tipo numeración"  />
                                        <h:outputText value="&#160;" />
                                        <h:selectOneMenu value="#{NumeracionBean.tipoNdcVO.ntnCodigo}" disabled="#{NumeracionBean.matrizVisible}">
                                            <f:selectItems value="#{NumeracionBean.listaTipoNdc}" />
                                            <p:ajax update="tipoNumeracion" global="false"/>
                                        </h:selectOneMenu>
                                        <p:commandLink ajax="true" rendered="#{NumeracionBean.tipoNdcVO.ntnCodigo != -1}" update="tipoNumeracion" global="false">
                                            <p:graphicImage value="#{ConfiguracionBean.rutaContexto}resources/images/borrar.png" style="border:0px"/>
                                            <f:setPropertyActionListener target="#{NumeracionBean.tipoNdcVO.ntnCodigo}" value="-1"/>
                                        </p:commandLink>
                                    </h:panelGrid>
                               </h:panelGroup>
                            </h:panelGrid>
                            
                            <h:outputText value="Número inicio (&gt;)"/>
                            <h:panelGrid columns="2" cellpadding="0" cellspacing="0">
                                <h:inputText id="numeroInicio" value="#{NumeracionBean.numInicio}" maxlength="7" size="7" validator="#{Validador.enteroMayorIgualCero}"/>
                                <p:message for="numeroInicio" />
                            </h:panelGrid>
                            <h:outputText value="Número Fin (&lt;)"/>
                            <h:panelGrid columns="2" cellpadding="0" cellspacing="0">
                                <h:inputText id="numeroFin" value="#{NumeracionBean.numFin}" maxlength="7" size="7" validator="#{Validador.enteroMayorIgualCero}"/>
                                <p:message for="numeroFin" />
                            </h:panelGrid>
                            
                            <h:outputText value=" "/>
                            <h:panelGrid columns="2" cellspacing="0" cellpadding="0">
                                <h:outputText value="Borrar todos los filtros &nbsp;" />
                                <p:commandLink ajax="true" update="frmNum" action="#{NumeracionBean.cambiarDepartamento}" >
                                    <p:graphicImage value="#{ConfiguracionBean.rutaContexto}resources/images/borrar.png" style="border:0px"/>
                                    <f:setPropertyActionListener target="#{NumeracionBean.operadorVO.emrCodigo}" value="-1"/>
                                    <f:setPropertyActionListener target="#{NumeracionBean.departamentoVO.codigoDepartamento}" value="-1"/>
                                    <f:setPropertyActionListener target="#{NumeracionBean.municipioVO.codigoMunicipio}" value="-1"/>
                                    <f:setPropertyActionListener target="#{NumeracionBean.estadoVO.esnCodigo}" value="-1"/>
                                    <f:setPropertyActionListener target="#{NumeracionBean.tipoNdcVO.ntnCodigo}" value="-1"/>
                                    <f:setPropertyActionListener target="#{NumeracionBean.numInicio}" value=""/>
                                    <f:setPropertyActionListener target="#{NumeracionBean.numFin}" value=""/>
                                </p:commandLink>
                            </h:panelGrid>
                            
                            
                        </h:panelGrid>
                        <h:panelGrid columns="2">
                            <p:commandButton value="Consultar" actionListener="#{NumeracionBean.buscar}" ajax="true" update=":pgNumeracion,frmNum" rendered="#{!NumeracionBean.matrizVisible}">
                                <f:setPropertyActionListener target="#{NumeracionBean.selectedNumsAccion}" value="false"/>
                                <f:setPropertyActionListener target="#{NumeracionBean.mensajeMatriz}" value=""/>
                            </p:commandButton>
                            <p:commandButton value="Consultar" actionListener="#{NumeracionBean.matriz}" ajax="true" update="frmNum" rendered="#{NumeracionBean.matrizVisible}"/>
                            <p:commandLink value="Ver #{NumeracionBean.matrizVisible ? 'Lista' : 'Matriz'}" ajax="true" actionListener="#{NumeracionBean.verMatriz}" update=":frmNum:pgNum"/>
                            
                        </h:panelGrid>
                        <h:panelGrid id="mensajeMatriz">
                            <h:outputText value="#{NumeracionBean.mensajeMatriz}" escape="false" style="color: red; font-weight: bold;" rendered="#{NumeracionBean.mensajeMatriz != ''}"/>
                        </h:panelGrid>
                    </h:panelGrid>
                </h:form>
            </p:panel>
            
            <h:panelGroup id="contenido">
                <h:panelGroup rendered="#{!NumeracionBean.matrizVisible}">
                    <ui:include src="#{ConfiguracionBean.rutaContexto}numeracion-lista.xhtml"/>
                </h:panelGroup>
                <h:panelGroup rendered="#{NumeracionBean.matrizVisible}">
                    <ui:include src="#{ConfiguracionBean.rutaContexto}numeracion-matriz.xhtml"/>
                </h:panelGroup>
            </h:panelGroup>
            
            <h:panelGroup rendered="#{UserBean.permisos.numeracion or (UserBean.liberar or UserBean.reservar)}">
                <ui:include src="#{ConfiguracionBean.rutaContexto}usuarios/detalleNumeracion.xhtml"/>
            </h:panelGroup>
            
        </h:panelGroup>
            
    </ui:define>
</ui:composition>